<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Ontario Real Estate Transaction Tool (Personal Use)</title>
    <style>
        /* MOBILE-FIRST RESPONSIVE DESIGN - COMPLETE WORKING VERSION */
        :root {
            --primary: #1e40af;
            --primary-light: #3b82f6;
            --primary-dark: #1e3a8a;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            
            /* Light Theme Default */
            --bg-main: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-accent: #f3f4f6;
            --text-main: #111827;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --border-main: #e5e7eb;
            --border-light: #f3f4f6;
            
            /* Mobile-optimized spacing */
            --space-xs: 0.5rem;
            --space-sm: 0.75rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            
            /* Mobile-first font sizes */
            --text-xs: 0.875rem;
            --text-sm: 1rem;
            --text-md: 1.125rem;
            --text-lg: 1.25rem;
            --text-xl: 1.5rem;
            --text-2xl: 2rem;
            
            /* Touch-friendly sizes */
            --touch-target: 48px;
            --touch-padding: 12px 16px;
            --input-height: 52px;
            --button-height: 48px;
        }

        /* Dark Theme - WORKING */
        html[data-theme="dark"], [data-theme="dark"] {
            --bg-main: #1f2937 !important;
            --bg-secondary: #111827 !important;
            --bg-accent: #374151 !important;
            --text-main: #f9fafb !important;
            --text-secondary: #d1d5db !important;
            --text-muted: #9ca3af !important;
            --border-main: #374151 !important;
            --border-light: #4b5563 !important;
        }

        /* Base Reset */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-main);
            line-height: 1.5;
            transition: all 0.3s ease;
            overscroll-behavior: none;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 var(--space-md);
        }

        @media (min-width: 768px) {
            .container {
                max-width: 1200px;
                padding: 0 var(--space-xl);
            }
        }

        /* THEME TOGGLE - GUARANTEED WORKING */
        .theme-toggle {
            position: fixed !important;
            top: var(--space-md) !important;
            right: var(--space-md) !important;
            z-index: 9999 !important;
            background: var(--bg-main) !important;
            border: 2px solid var(--border-main) !important;
            border-radius: 24px !important;
            padding: var(--space-xs) var(--space-sm) !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
            display: flex !important;
            align-items: center !important;
            gap: var(--space-xs) !important;
            font-size: var(--text-xs) !important;
            font-weight: 600 !important;
            color: var(--text-main) !important;
            min-width: 70px !important;
            min-height: var(--touch-target) !important;
            touch-action: manipulation;
        }

        .theme-toggle:hover, .theme-toggle:focus {
            transform: translateY(-1px) !important;
            border-color: var(--primary) !important;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15) !important;
            outline: none;
        }

        .theme-toggle-icon {
            width: 16px !important;
            height: 16px !important;
            color: var(--text-main) !important;
            transition: all 0.3s ease !important;
        }

        .hidden { display: none !important; }

        /* HEADER */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: var(--space-2xl) 0 var(--space-xl);
            margin-bottom: var(--space-xl);
            padding-top: calc(var(--touch-target) + var(--space-xl));
        }

        .header__content {
            display: flex;
            flex-direction: column;
            text-align: center;
            gap: var(--space-lg);
        }

        .header__title {
            font-size: var(--text-xl);
            font-weight: 700;
            line-height: 1.2;
        }

        .header__subtitle {
            font-size: var(--text-sm);
            opacity: 0.9;
            font-weight: 500;
        }

        .header__logo {
            align-self: center;
            opacity: 0.9;
        }

        @media (min-width: 768px) {
            .header {
                padding: var(--space-2xl) 0;
                padding-top: calc(var(--touch-target) + var(--space-lg));
            }

            .header__content {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                text-align: left;
            }

            .header__title {
                font-size: var(--text-2xl);
            }

            .header__subtitle {
                font-size: var(--text-md);
            }

            .header__logo {
                margin-left: var(--space-xl);
            }
        }

        /* CARDS */
        .card {
            background: var(--bg-main);
            border: 1px solid var(--border-main);
            border-radius: 16px;
            margin-bottom: var(--space-xl);
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        .card__header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border-light);
            background: var(--bg-accent);
        }

        .card__header h2 {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: var(--space-sm);
            line-height: 1.3;
        }

        .card__body {
            padding: var(--space-lg);
        }

        @media (min-width: 768px) {
            .card__header {
                padding: var(--space-xl);
            }

            .card__header h2 {
                font-size: var(--text-xl);
                margin-bottom: var(--space-md);
            }

            .card__body {
                padding: var(--space-xl);
            }
        }

        /* Warning Card */
        .warning-card {
            border-left: 4px solid var(--warning);
            background: linear-gradient(135deg, rgba(217, 119, 6, 0.03) 0%, var(--bg-main) 100%);
        }

        .warning-header {
            display: flex;
            align-items: flex-start;
            gap: var(--space-sm);
        }

        .warning-header h2 {
            color: var(--warning);
            font-size: var(--text-md);
            line-height: 1.4;
        }

        .warning-icon {
            color: var(--warning);
            flex-shrink: 0;
            margin-top: 2px;
        }

        @media (min-width: 768px) {
            .warning-header {
                align-items: center;
                gap: var(--space-md);
            }

            .warning-header h2 {
                font-size: var(--text-lg);
            }
        }

        /* UNIVERSAL FORMS - MOBILE-FIRST */
        .universal-forms-list {
            display: flex !important;
            flex-direction: column !important;
            gap: var(--space-lg) !important;
            padding: 0 !important;
        }

        @media (min-width: 1024px) {
            .universal-forms-list {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: var(--space-lg) !important;
            }
        }

        .form-item {
            display: flex !important;
            align-items: flex-start !important;
            gap: var(--space-md) !important;
            padding: var(--space-lg) !important;
            background: linear-gradient(135deg, var(--bg-accent) 0%, var(--bg-main) 100%) !important;
            border-radius: 12px !important;
            border-left: 4px solid var(--primary) !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05) !important;
            touch-action: manipulation;
        }

        .form-item:hover, .form-item:focus-within {
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1) !important;
        }

        .form-item__checkbox {
            width: 24px;
            height: 24px;
            accent-color: var(--primary);
            margin-top: 2px;
            flex-shrink: 0;
            cursor: pointer;
        }

        .form-item__content {
            flex: 1;
            min-width: 0;
        }

        .form-item__header {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            margin-bottom: var(--space-sm);
        }

        .form-item__name {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-main);
            line-height: 1.3;
            word-wrap: break-word;
        }

        .form-item__number {
            font-size: var(--text-xs);
            font-weight: 500;
            color: var(--primary);
            background: rgba(30, 64, 175, 0.1);
            padding: var(--space-xs);
            border-radius: 6px;
            align-self: flex-start;
            border: 1px solid rgba(30, 64, 175, 0.2);
        }

        .form-item__details {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }

        .form-item__purpose,
        .form-item__timing,
        .form-item__compliance,
        .form-item__notes {
            font-size: var(--text-xs);
            line-height: 1.4;
        }

        .form-item__purpose {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .form-item__timing {
            color: var(--text-muted);
            font-style: italic;
        }

        .form-item__compliance {
            color: var(--success);
            font-weight: 600;
        }

        .form-item__notes {
            color: var(--text-muted);
        }

        @media (min-width: 768px) {
            .form-item {
                min-height: 140px !important;
            }

            .form-item__header {
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-start;
            }

            .form-item__name {
                font-size: var(--text-md);
            }

            .form-item__number {
                font-size: var(--text-sm);
                white-space: nowrap;
            }
        }

        /* FORMS */
        .form {
            display: flex;
            flex-direction: column;
            gap: var(--space-xl);
        }

        .form-section {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
        }

        .form-section__title {
            font-size: var(--text-md);
            font-weight: 600;
            color: var(--text-main);
            padding-bottom: var(--space-sm);
            border-bottom: 2px solid var(--border-main);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            line-height: 1.3;
        }

        @media (min-width: 768px) {
            .form-section__title {
                font-size: var(--text-lg);
                padding-bottom: var(--space-md);
            }
        }

        .required {
            color: var(--danger);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
        }

        .form-label {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: var(--space-sm);
            line-height: 1.4;
        }

        .form-group__options {
            display: flex !important;
            flex-direction: column !important;
            gap: var(--space-sm) !important;
        }

        .form-group__options--checkboxes {
            gap: var(--space-sm) !important;
        }

        @media (min-width: 768px) {
            .form-group__options--checkboxes {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: var(--space-sm) !important;
            }
        }

        @media (min-width: 1024px) {
            .form-group__options--checkboxes {
                grid-template-columns: repeat(3, 1fr) !important;
            }
        }

        /* RADIO/CHECKBOX OPTIONS - TOUCH OPTIMIZED */
        .radio-option,
        .checkbox-option {
            display: flex !important;
            align-items: flex-start !important;
            gap: var(--space-sm) !important;
            padding: var(--space-md) !important;
            border: 2px solid var(--border-main) !important;
            border-radius: 12px !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            background: var(--bg-main) !important;
            touch-action: manipulation;
            min-height: var(--input-height);
        }

        .radio-option:hover, .radio-option:focus-within,
        .checkbox-option:hover, .checkbox-option:focus-within {
            border-color: var(--primary-light) !important;
            background: var(--bg-accent) !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
        }

        .radio-option input,
        .checkbox-option input {
            width: 20px !important;
            height: 20px !important;
            margin: 2px 0 0 0 !important;
            flex-shrink: 0 !important;
            accent-color: var(--primary) !important;
            cursor: pointer !important;
        }

        .radio-option:has(input:checked),
        .checkbox-option:has(input:checked) {
            border-color: var(--primary) !important;
            background: rgba(30, 64, 175, 0.05) !important;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1) !important;
        }

        .radio-option__label,
        .checkbox-option__label {
            font-weight: 600 !important;
            color: var(--text-main) !important;
            flex: 1 !important;
            display: flex !important;
            flex-direction: column !important;
            gap: var(--space-xs) !important;
            font-size: var(--text-sm) !important;
            line-height: 1.4 !important;
        }

        .radio-option__description {
            font-size: var(--text-xs) !important;
            font-weight: 400 !important;
            color: var(--text-secondary) !important;
            line-height: 1.3 !important;
        }

        /* BUTTONS - MOBILE OPTIMIZED */
        .btn {
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            gap: var(--space-xs) !important;
            padding: var(--touch-padding) !important;
            font-size: var(--text-sm) !important;
            font-weight: 600 !important;
            border: none !important;
            border-radius: 12px !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            font-family: inherit !important;
            min-height: var(--button-height) !important;
            width: 100% !important;
            touch-action: manipulation;
            -webkit-appearance: none;
        }

        .btn:disabled {
            opacity: 0.6 !important;
            cursor: not-allowed !important;
        }

        .btn:hover:not(:disabled), .btn:focus:not(:disabled) {
            transform: translateY(-1px) !important;
            outline: none;
        }

        .btn--primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%) !important;
            color: white !important;
        }

        .btn--primary:hover:not(:disabled), .btn--primary:focus:not(:disabled) {
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3) !important;
        }

        .btn--secondary {
            background: var(--bg-main) !important;
            color: var(--primary) !important;
            border: 2px solid var(--primary) !important;
        }

        .btn--secondary:hover:not(:disabled), .btn--secondary:focus:not(:disabled) {
            background: var(--primary) !important;
            color: white !important;
        }

        .btn--success {
            background: linear-gradient(135deg, var(--success) 0%, #047857 100%) !important;
            color: white !important;
        }

        .btn--success:hover:not(:disabled), .btn--success:focus:not(:disabled) {
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3) !important;
        }

        .btn--outline {
            background: transparent !important;
            color: var(--text-main) !important;
            border: 2px solid var(--border-main) !important;
        }

        .btn--outline:hover:not(:disabled), .btn--outline:focus:not(:disabled) {
            background: var(--bg-accent) !important;
        }

        .btn--large {
            padding: var(--space-md) var(--space-lg) !important;
            font-size: var(--text-md) !important;
            min-height: 56px !important;
        }

        .btn--small {
            padding: var(--space-sm) var(--space-md) !important;
            font-size: var(--text-xs) !important;
            min-height: 40px !important;
            width: auto !important;
        }

        @media (min-width: 768px) {
            .btn {
                width: auto !important;
                min-width: 140px !important;
            }
        }

        /* FORM ACTIONS - MOBILE STACK */
        .form__actions {
            display: flex !important;
            flex-direction: column !important;
            gap: var(--space-md) !important;
            padding-top: var(--space-lg) !important;
            border-top: 1px solid var(--border-main) !important;
            margin-top: var(--space-lg) !important;
        }

        @media (min-width: 768px) {
            .form__actions {
                flex-direction: row !important;
                gap: var(--space-lg) !important;
                padding-top: var(--space-xl) !important;
                margin-top: var(--space-xl) !important;
            }
        }

        /* RESULTS SECTION */
        .results-section {
            display: flex;
            flex-direction: column;
            gap: var(--space-xl);
            margin-top: var(--space-2xl);
        }

        /* PROPERTY FORMS */
        .property-forms-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
        }

        .forms-category {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .forms-category__title {
            font-size: var(--text-md);
            font-weight: 600;
            color: var(--primary);
            padding-bottom: var(--space-sm);
            border-bottom: 2px solid var(--primary);
        }

        .forms-category__list {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            padding-left: var(--space-md);
        }

        .form-list-item {
            color: var(--text-main);
            position: relative;
            padding: var(--space-xs) 0;
            font-size: var(--text-sm);
            line-height: 1.4;
        }

        .form-list-item::before {
            content: 'â€¢';
            color: var(--primary);
            font-weight: bold;
            position: absolute;
            left: calc(-1 * var(--space-md));
        }

        /* CLAUSES */
        .clauses-section {
            display: flex;
            flex-direction: column;
            gap: var(--space-2xl);
        }

        .clause-category {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
        }

        .clause-category__title {
            font-size: var(--text-md);
            font-weight: 600;
            color: var(--primary);
            padding-bottom: var(--space-sm);
            border-bottom: 2px solid var(--primary);
        }

        .clauses-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
        }

        .clause-item {
            background: var(--bg-main);
            border: 2px solid var(--border-main);
            border-radius: 12px;
            padding: var(--space-lg);
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }

        .clause-item:hover, .clause-item:focus-within {
            border-color: var(--primary-light);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .clause-item__header {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .clause-item__name {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-main);
            line-height: 1.3;
        }

        .clause-item__reference {
            font-size: var(--text-xs);
            font-weight: 500;
            color: var(--primary);
            background: rgba(30, 64, 175, 0.1);
            padding: var(--space-xs);
            border-radius: 6px;
            align-self: flex-start;
        }

        .clause-item__text {
            font-family: 'SF Mono', Monaco, 'Consolas', monospace;
            font-size: var(--text-xs);
            line-height: 1.5;
            color: var(--text-main);
            background: var(--bg-accent);
            border: 1px solid var(--border-main);
            border-radius: 8px;
            padding: var(--space-md);
            margin: var(--space-md) 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 200px;
            overflow-y: auto;
            resize: vertical;
        }

        .clause-item__details {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            padding-top: var(--space-md);
            border-top: 1px solid var(--border-light);
        }

        .clause-item__label {
            font-size: var(--text-xs);
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .clause-item__description {
            font-size: var(--text-xs);
            color: var(--text-main);
            margin-top: var(--space-xs);
            line-height: 1.4;
        }

        @media (min-width: 768px) {
            .clause-category__title {
                font-size: var(--text-lg);
            }

            .clause-item__header {
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-start;
            }

            .clause-item__name {
                font-size: var(--text-md);
            }

            .clause-item__text {
                font-size: var(--text-sm);
            }

            .clause-item__details {
                flex-direction: row;
                gap: var(--space-lg);
            }
        }

        /* COMPLIANCE CHECKLIST */
        .compliance-checklist {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .compliance-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--bg-accent);
            border-radius: 8px;
            border-left: 4px solid var(--warning);
            min-height: var(--touch-target);
        }

        .compliance-item__checkbox {
            width: 20px;
            height: 20px;
            accent-color: var(--success);
            flex-shrink: 0;
            margin-top: 2px;
            cursor: pointer;
        }

        .compliance-item__text {
            flex: 1;
            color: var(--text-main);
            cursor: pointer;
            font-size: var(--text-sm);
            line-height: 1.4;
        }

        /* EXPORT ACTIONS */
        .export-actions {
            display: flex !important;
            flex-direction: column !important;
            gap: var(--space-md) !important;
        }

        @media (min-width: 768px) {
            .export-actions {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: var(--space-md) !important;
            }
        }

        @media (min-width: 1024px) {
            .export-actions {
                grid-template-columns: repeat(3, 1fr) !important;
            }
        }

        /* MOBILE TOAST */
        .copy-toast {
            position: fixed;
            bottom: var(--space-lg);
            left: var(--space-md);
            right: var(--space-md);
            background: linear-gradient(135deg, var(--success) 0%, #047857 100%);
            color: white;
            padding: var(--space-md) var(--space-lg);
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .copy-toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .copy-toast__content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
        }

        .copy-toast__text {
            font-size: var(--text-sm);
            font-weight: 500;
            text-align: center;
        }

        @media (min-width: 768px) {
            .copy-toast {
                left: auto;
                right: var(--space-lg);
                max-width: 320px;
            }

            .copy-toast__content {
                justify-content: flex-start;
            }

            .copy-toast__text {
                text-align: left;
            }
        }

        /* FOOTER */
        .footer {
            background: var(--bg-main);
            border-top: 1px solid var(--border-main);
            padding: var(--space-xl) 0;
            margin-top: var(--space-2xl);
        }

        .footer__content {
            text-align: center;
        }

        .footer__disclaimer {
            font-size: var(--text-xs);
            line-height: 1.5;
            margin-bottom: var(--space-md);
            color: var(--text-secondary);
        }

        .footer__copyright {
            font-size: var(--text-xs);
            color: var(--text-muted);
        }

        /* UTILITY CLASSES */
        .text-secondary {
            color: var(--text-secondary);
        }

        .text-center {
            text-align: center;
        }

        /* ACCESSIBILITY */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        @media (prefers-contrast: high) {
            :root {
                --border-main: #000000;
                --text-main: #000000;
                --bg-main: #ffffff;
            }

            [data-theme="dark"] {
                --border-main: #ffffff !important;
                --text-main: #ffffff !important;
                --bg-main: #000000 !important;
            }
        }

        button:focus,
        input:focus,
        textarea:focus,
        .radio-option:focus-within,
        .checkbox-option:focus-within {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        @media (max-width: 360px) {
            .theme-toggle {
                min-width: 60px !important;
                padding: var(--space-xs) !important;
            }

            .container {
                padding: 0 var(--space-sm);
            }

            .form-item {
                padding: var(--space-md) !important;
            }

            .card__header,
            .card__body {
                padding: var(--space-md);
            }
        }

        @media (min-width: 1440px) {
            .container {
                max-width: 1400px;
            }

            .universal-forms-list {
                grid-template-columns: repeat(3, 1fr) !important;
            }
        }
    </style>
</head>
<body>
    <!-- THEME TOGGLE BUTTON -->
    <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
        <svg class="theme-toggle-icon" id="theme-icon-light" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"></circle>
            <path d="m12 7-4-4M12 17l-4 4M17 12h4M7 12H3M15.54 8.46l2.83-2.83M5.17 19.83l2.83-2.83M8.46 15.54l-2.83 2.83M19.83 5.17l-2.83 2.83"></path>
        </svg>
        <svg class="theme-toggle-icon hidden" id="theme-icon-dark" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
        <span id="theme-text">Dark</span>
    </button>

    <header class="header">
        <div class="container">
            <div class="header__content">
                <div class="header__branding">
                    <h1 class="header__title">Ontario Real Estate Transaction Tool</h1>
                    <p class="header__subtitle">Personal Use Only | Full Compliance Guidance | RECO | FINTRAC | PIPEDA</p>
                </div>
                <div class="header__logo">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9,22 9,12 15,12 15,22"></polyline>
                    </svg>
                </div>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <!-- Universal Mandatory Forms -->
            <div class="universal-forms-section">
                <div class="card warning-card">
                    <div class="card__header">
                        <div class="warning-header">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="warning-icon">
                                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
                                <path d="M12 9v4"/>
                                <path d="m12 17 .01 0"/>
                            </svg>
                            <h2>âš ï¸ UNIVERSAL MANDATORY FORMS<br>Required for Every Transaction</h2>
                        </div>
                        <p class="text-secondary">These forms are required by RECO, FINTRAC, and PIPEDA for ALL Ontario real estate transactions regardless of type.</p>
                    </div>
                    <div class="card__body">
                        <div id="universal-forms-list" class="universal-forms-list">
                            <!-- Forms will be populated here by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transaction Profile Form -->
            <div class="input-section">
                <div class="card">
                    <div class="card__header">
                        <h2>Complete Transaction Profile</h2>
                        <p class="text-secondary">Classify your transaction for accurate form and clause recommendations with full compliance guidance.</p>
                    </div>
                    <div class="card__body">
                        <form id="transaction-form" class="form">
                            <div class="form-section">
                                <h3 class="form-section__title">Essential Classifications <span class="required">*</span></h3>
                                
                                <div class="form-group">
                                    <label class="form-label">Property Type</label>
                                    <div class="form-group__options">
                                        <label class="radio-option">
                                            <input type="radio" name="property_type" value="residential_freehold" required>
                                            <div>
                                                <span class="radio-option__label">Residential Freehold</span>
                                                <div class="radio-option__description">Houses, townhomes, detached properties</div>
                                            </div>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="property_type" value="residential_condo" required>
                                            <div>
                                                <span class="radio-option__label">Residential Condo</span>
                                                <div class="radio-option__description">Condo units, apartments</div>
                                            </div>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="property_type" value="commercial" required>
                                            <div>
                                                <span class="radio-option__label">Commercial</span>
                                                <div class="radio-option__description">Office, retail, industrial</div>
                                            </div>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="property_type" value="vacant_land" required>
                                            <div>
                                                <span class="radio-option__label">Vacant Land</span>
                                                <div class="radio-option__description">Undeveloped lots</div>
                                            </div>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="property_type" value="new_construction" required>
                                            <div>
                                                <span class="radio-option__label">New Construction</span>
                                                <div class="radio-option__description">Pre-construction, newly built</div>
                                            </div>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="property_type" value="business_purchase" required>
                                            <div>
                                                <span class="radio-option__label">Business Purchase</span>
                                                <div class="radio-option__description">Buying an existing business</div>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Client Type</label>
                                    <div class="form-group__options">
                                        <label class="radio-option">
                                            <input type="radio" name="client_type" value="individual" required>
                                            <div>
                                                <span class="radio-option__label">Individual</span>
                                                <div class="radio-option__description">Personal buyers/sellers</div>
                                            </div>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="client_type" value="corporate" required>
                                            <div>
                                                <span class="radio-option__label">Corporate</span>
                                                <div class="radio-option__description">Companies, corporations</div>
                                            </div>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="client_type" value="mixed" required>
                                            <div>
                                                <span class="radio-option__label">Mixed</span>
                                                <div class="radio-option__description">Individual + Corporate</div>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Representation Status</label>
                                    <div class="form-group__options">
                                        <label class="radio-option">
                                            <input type="radio" name="representation_status" value="client_represented" required>
                                            <div>
                                                <span class="radio-option__label">Client Represented</span>
                                                <div class="radio-option__description">You represent the client</div>
                                            </div>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="representation_status" value="self_represented" required>
                                            <div>
                                                <span class="radio-option__label">Self-Represented</span>
                                                <div class="radio-option__description">Party represents themselves</div>
                                            </div>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="representation_status" value="multiple_representation" required>
                                            <div>
                                                <span class="radio-option__label">Multiple Representation</span>
                                                <div class="radio-option__description">You represent both parties</div>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Fund Handling</label>
                                    <div class="form-group__options">
                                        <label class="radio-option">
                                            <input type="radio" name="fund_handling" value="deposits_received" required>
                                            <div>
                                                <span class="radio-option__label">Deposits Received by Brokerage</span>
                                                <div class="radio-option__description">You will handle client funds</div>
                                            </div>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="fund_handling" value="no_funds" required>
                                            <div>
                                                <span class="radio-option__label">No Funds Handled</span>
                                                <div class="radio-option__description">No deposit handling</div>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3 class="form-section__title">Additional Classifications</h3>
                                <p class="text-secondary">Optional selections for enhanced accuracy</p>
                                
                                <div class="form-group">
                                    <label class="form-label">Additional Characteristics</label>
                                    <div class="form-group__options form-group__options--checkboxes">
                                        <label class="checkbox-option">
                                            <input type="checkbox" name="transaction_details" value="high_value">
                                            <span class="checkbox-option__label">High Value ($1M+)</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" name="transaction_details" value="out_of_province">
                                            <span class="checkbox-option__label">Out-of-Province Clients</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" name="transaction_details" value="foreign_nationals">
                                            <span class="checkbox-option__label">Foreign Nationals</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" name="transaction_details" value="expedited">
                                            <span class="checkbox-option__label">Expedited Timeline</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" name="transaction_details" value="first_time_buyer">
                                            <span class="checkbox-option__label">First-time buyer</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" name="transaction_details" value="needs_financing">
                                            <span class="checkbox-option__label">Needs financing</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" name="transaction_details" value="selling_to_buy">
                                            <span class="checkbox-option__label">Selling to buy</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" name="transaction_details" value="rural">
                                            <span class="checkbox-option__label">Rural property</span>
                                        </label>
                                        <label class="checkbox-option">
                                            <input type="checkbox" name="transaction_details" value="older_home">
                                            <span class="checkbox-option__label">Older home (40+ years)</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="form__actions">
                                <button type="submit" class="btn btn--primary btn--large">Generate Complete Transaction Analysis</button>
                                <button type="reset" class="btn btn--secondary">Reset Form</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div id="results-section" class="results-section" style="display: none;">
                
                <!-- Property-Specific Forms -->
                <div class="card">
                    <div class="card__header">
                        <h2>Property-Specific OREA Forms</h2>
                        <p class="text-secondary">Required forms specific to your transaction type.</p>
                    </div>
                    <div class="card__body">
                        <div id="property-forms-list" class="property-forms-list">
                            <!-- Property-specific forms will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Clause Recommendations -->
                <div class="card">
                    <div class="card__header">
                        <h2>Clause Recommendations with Copy-Ready Text</h2>
                        <p class="text-secondary">Complete OREA clause text for your agreements.</p>
                    </div>
                    <div class="card__body">
                        <div class="clauses-section">
                            <div class="clause-category">
                                <h3 class="clause-category__title">Mandatory Clauses</h3>
                                <div id="mandatory-clauses" class="clauses-list">
                                    <!-- Mandatory clauses will be populated here -->
                                </div>
                            </div>
                            
                            <div class="clause-category">
                                <h3 class="clause-category__title">Recommended Clauses</h3>
                                <div id="recommended-clauses" class="clauses-list">
                                    <!-- Recommended clauses will be populated here -->
                                </div>
                            </div>
                            
                            <div class="clause-category">
                                <h3 class="clause-category__title">Conditional Clauses</h3>
                                <div id="conditional-clauses" class="clauses-list">
                                    <!-- Conditional clauses will be populated here -->
                                </div>
                            </div>
                        </div>

                        <!-- Clause Filtering Section -->
                        <div class="clauses-section">
                            <h2>Filtered Clauses</h2>
                            <div id="clause-container" class="clauses-list">
                                <!-- Filtered clauses will be dynamically inserted here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Compliance Checklist -->
                <div class="card">
                    <div class="card__header">
                        <h2>Transaction Compliance Checklist</h2>
                        <p class="text-secondary">Ensure all regulatory requirements are met.</p>
                    </div>
                    <div class="card__body">
                        <div id="compliance-checklist" class="compliance-checklist">
                            <!-- Compliance checklist will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Export Actions -->
                <div class="card">
                    <div class="card__header">
                        <h2>Export & Copy Functions</h2>
                        <p class="text-secondary">Generate summaries and copy text for your agreements.</p>
                    </div>
                    <div class="card__body">
                        <div class="export-actions">
                            <button id="copy-all-clauses" class="btn btn--primary">Copy All Selected Clauses</button>
                            <button id="generate-summary" class="btn btn--success">Generate Transaction Summary</button>
                            <button id="print-checklist" class="btn btn--secondary">Print Compliance Checklist</button>
                            <button id="export-forms" class="btn btn--secondary">Export Form List</button>
                            <button id="start-new-transaction" class="btn btn--outline">Start New Transaction</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer__content">
                <p class="footer__disclaimer">
                    <strong>Disclaimer:</strong> This tool provides guidance based on current Ontario real estate regulations. 
                    Always consult with qualified legal counsel and verify current requirements with RECO and OREA. 
                    Professional judgment is required for all real estate transactions.
                </p>
                <p class="footer__copyright">
                    Â© 2025 Ontario Real Estate Transaction Tool. For personal use only.
                </p>
            </div>
        </div>
    </footer>

    <!-- Copy Success Toast -->
    <div id="copy-toast" class="copy-toast">
        <div class="copy-toast__content">
            <svg class="copy-toast__icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20,6 9,17 4,12"></polyline>
            </svg>
            <span class="copy-toast__text">Copied to clipboard!</span>
        </div>
    </div>

    <script>
        // COMPLETE WORKING JAVASCRIPT - MOBILE OPTIMIZED
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeThemeToggle();
            setupFormHandlers();
            setupExportHandlers();
            displayUniversalMandatoryForms();
            initializeMobileOptimizations();
        });

        function initializeMobileOptimizations() {
            // Prevent zoom on input focus for iOS
            const inputs = document.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    if (window.innerWidth < 768) {
                        const viewport = document.querySelector('meta[name=viewport]');
                        if (viewport) {
                            viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
                        }
                    }
                });

                input.addEventListener('blur', function() {
                    if (window.innerWidth < 768) {
                        const viewport = document.querySelector('meta[name=viewport]');
                        if (viewport) {
                            viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, user-scalable=yes');
                        }
                    }
                });
            });

            // Add smooth scrolling for form submissions on mobile
            if (window.innerWidth < 768) {
                const form = document.getElementById('transaction-form');
                if (form) {
                    form.addEventListener('submit', function() {
                        setTimeout(() => {
                            const resultsSection = document.getElementById('results-section');
                            if (resultsSection && resultsSection.style.display !== 'none') {
                                resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            }
                        }, 100);
                    });
                }
            }
        }

        function initializeThemeToggle() {
            const themeToggle = document.getElementById('theme-toggle');
            const themeIconLight = document.getElementById('theme-icon-light');
            const themeIconDark = document.getElementById('theme-icon-dark');
            const themeText = document.getElementById('theme-text');
            
            // Check for saved theme or default to light
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeToggleUI(savedTheme);
            
            // Add click event listener
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    const currentTheme = document.documentElement.getAttribute('data-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    
                    document.documentElement.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                    updateThemeToggleUI(newTheme);
                    
                    // Show feedback with haptic feedback on mobile
                    if ('vibrate' in navigator) {
                        navigator.vibrate(50);
                    }
                    showCopyToast(`Switched to ${newTheme} mode!`);
                });
            }
            
            function updateThemeToggleUI(theme) {
                if (theme === 'dark') {
                    themeIconLight?.classList.add('hidden');
                    themeIconDark?.classList.remove('hidden');
                    if (themeText) themeText.textContent = 'Light';
                } else {
                    themeIconLight?.classList.remove('hidden');
                    themeIconDark?.classList.add('hidden');
                    if (themeText) themeText.textContent = 'Dark';
                }
            }
        }

        // Universal Mandatory Forms Data
        const universalMandatoryForms = {
            "reco_information_guide": {
                "form_name": "RECO Information Guide", 
                "form_number": "RECO Guide",
                "purpose": "Consumer protection - explains rights, duties, and expectations",
                "when_required": "Before any services or assistance are provided",
                "notes": "Must be explained to client and acknowledgement obtained",
                "compliance": "RECO/TRESA requirement"
            },
            "privacy_policy_disclosure": {
                "form_name": "Privacy Policy Disclosure",
                "form_number": "PIPEDA Compliance Form",
                "purpose": "Informs clients how personal information is collected, used, and disclosed", 
                "when_required": "Before collecting any personal information",
                "notes": "Must explain data handling practices and obtain consent",
                "compliance": "PIPEDA requirement"
            },
            "fintrac_individual_id": {
                "form_name": "FINTRAC Individual Identification Information Record",
                "form_number": "OREA Form 630 / CREA Template",
                "purpose": "Anti-money laundering compliance for individual clients",
                "when_required": "For individual buyers/sellers before offer acceptance",
                "notes": "Photo ID, Credit File, or Dual Process method required",
                "compliance": "FINTRAC/PCMLTFA requirement"
            },
            "fintrac_corporate_id": {
                "form_name": "FINTRAC Corporation/Entity Identification Information Record", 
                "form_number": "CREA Corporate Template",
                "purpose": "Anti-money laundering compliance for corporate clients",
                "when_required": "For corporate buyers/sellers before offer acceptance",
                "notes": "Verify existence of corporation and identify directors",
                "compliance": "FINTRAC/PCMLTFA requirement"
            },
            "receipt_of_funds": {
                "form_name": "Receipt of Funds Record",
                "form_number": "CREA Template",
                "purpose": "Records all funds received by brokerage",
                "when_required": "When any deposit or payment is received",
                "notes": "Required for trust account compliance and FINTRAC",
                "compliance": "FINTRAC/PCMLTFA requirement"
            },
            "representation_agreement": {
                "form_name": "Buyer/Seller Representation Agreement",
                "form_number": "OREA Form 300 (BRA) / Form 200 (Listing)",
                "purpose": "Establishes client relationship and service terms",
                "when_required": "Before providing services to buyers/sellers",
                "notes": "Defines duties, commission, and representation type",
                "compliance": "RECO/TRESA requirement"
            },
            "self_represented_acknowledgement": {
                "form_name": "Information and Disclosure to Self-Represented Party", 
                "form_number": "RECO Form",
                "purpose": "Acknowledges party is not represented by the brokerage",
                "when_required": "Before assisting any unrepresented party",
                "notes": "Explains limitations of assistance that can be provided",
                "compliance": "RECO/TRESA requirement"
            },
            "cooperation_confirmation": {
                "form_name": "Confirmation of Co-operation and Representation",
                "form_number": "OREA Form 320", 
                "purpose": "Confirms agency relationships in the transaction",
                "when_required": "Before presenting offers or showing properties",
                "notes": "Clarifies who represents whom in the transaction",
                "compliance": "RECO/TRESA requirement"
            }
        };

        const transactionSpecificForms = {
            "residential_freehold": {
                "primary": "OREA Form 100 - Agreement of Purchase and Sale",
                "additional": [
                    "OREA Form 105 - Schedule for Additional Terms",
                    "OREA Form 120 - Amendment to Agreement",
                    "OREA Form 121 - Notice to Remove Condition(s)",
                    "OREA Form 220 - Seller Property Information Statement (SPIS)"
                ]
            },
            "residential_condo": {
                "primary": "OREA Form 101 - Agreement of Purchase and Sale (Condominium)",
                "additional": [
                    "OREA Form 105 - Schedule for Additional Terms",
                    "OREA Form 150 - Assignment of Agreement (Condominium)",
                    "OREA Form 120 - Amendment to Agreement"
                ]
            },
            "commercial": {
                "primary": "OREA Form 500 - Agreement of Purchase and Sale (Commercial)",
                "additional": [
                    "OREA Form 501 - Agreement of Purchase and Sale (Commercial Condo)",
                    "OREA Form 505 - Schedule (Commercial)",
                    "OREA Form 570 - Amendment (Commercial)"
                ]
            },
            "vacant_land": {
                "primary": "OREA Form 100 - Agreement of Purchase and Sale",
                "additional": [
                    "OREA Form 105 - Schedule for Development/Zoning",
                    "Environmental Assessment Schedules",
                    "Severance/Subdivision Schedules"
                ]
            },
            "new_construction": {
                "primary": "Builder Purchase Agreement + TARION Schedules",
                "additional": [
                    "TARION Statement of Critical Dates",
                    "TARION Schedule A - Defects and Standards",
                    "TARION Schedule B - Warranty Coverage",
                    "HST New Home Documentation"
                ]
            },
            "business_purchase": {
                "primary": "OREA Form 502 - Agreement of Purchase and Sale (Business)",
                "additional": [
                    "OREA Form 503 - Sale of Business Statement",
                    "OREA Form 504 - Schedule (Business Purchase)"
                ]
            }
        };

        const clauseDatabase = {
            "MORT-2": {
                "name": "Condition - Arranging a New Mortgage",
                "category": "Financing",
                "text": "This Offer is conditional upon the Buyer arranging, at the Buyer's own expense, a new _________________ mortgage for not less than $ _________________ , bearing interest at a rate of not more than _______ % per annum, calculated semi-annually not in advance, for a term of not less than _______ year(s), with a payment period not exceeding _______ year(s), repayable in blended monthly payments, including principal and interest. Unless the Buyer gives notice in writing delivered to the Seller personally or in accordance with any other provisions for the delivery of notice in this Agreement of Purchase and Sale or any Schedule thereto not later than _______ p.m. on the ______ day of ________________, 20____, that this condition is fulfilled, this Offer shall be null and void and the deposit shall be returned to the Buyer in full without deduction. This condition is included for the benefit of the Buyer and may be waived at the Buyer's sole option by notice in writing to the Seller as aforesaid within the time period stated herein.",
                "purpose": "Protects buyer if unable to secure required mortgage financing",
                "when_to_use": "All purchases requiring mortgage financing",
                "risk_without": "Buyer legally obligated without confirmed financing"
            },
            "INSP-1": {
                "name": "Condition - Home Inspector (General Inspection)",
                "category": "Inspection",
                "text": "This Offer is conditional upon the Buyer obtaining, at the Buyer's own expense, a home inspection of the property and all buildings and structures thereon and the Buyer obtaining a report satisfactory to the Buyer in the Buyer's sole and absolute discretion. Unless the Buyer gives notice in writing delivered to the Seller personally or in accordance with any other provisions for the delivery of notice in this Agreement of Purchase and Sale or any Schedule thereto not later than _______ p.m. on the ______ day of ________________, 20____, that this condition is fulfilled, this Offer shall be null and void and the deposit shall be returned to the Buyer in full without deduction. The Seller agrees to co-operate in providing access to the property for the purpose of this inspection. This condition is included for the benefit of the Buyer and may be waived at the Buyer's sole option by notice in writing to the Seller as aforesaid within the time period stated herein.",
                "purpose": "Allows professional inspection to identify defects before closing",
                "when_to_use": "All residential property purchases",
                "risk_without": "Unknown defects or safety issues"
            },
            "INSUR-1": {
                "name": "Condition - Arranging Insurance",
                "category": "Insurance",
                "text": "This Offer is conditional upon the Buyer obtaining, at the Buyer's expense, satisfactory insurance coverage for the property. Unless the Buyer gives notice in writing delivered to the Seller personally or in accordance with any other provisions for the delivery of notice in this Agreement of Purchase and Sale or any Schedule thereto not later than _______ p.m. on the ______ day of ________________, 20____, that this condition is fulfilled, this Offer shall be null and void and the deposit shall be returned to the Buyer in full without deduction. This condition is included for the benefit of the Buyer and may be waived at the Buyer's sole option by notice in writing to the Seller as aforesaid within the time period stated herein.",
                "purpose": "Ensures buyer can obtain property insurance before closing",
                "when_to_use": "All property purchases",
                "risk_without": "Unable to insure or prohibitive costs"
            }
        };

        // Application State
        let currentTransaction = {
            propertyType: null,
            clientType: null,
            representationStatus: null,
            fundHandling: null
        };

        // Display Universal Mandatory Forms
        function displayUniversalMandatoryForms() {
            const container = document.getElementById('universal-forms-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            Object.entries(universalMandatoryForms).forEach(([formId, form]) => {
                const formItem = createUniversalFormItem(form);
                container.appendChild(formItem);
            });
        }

        // Create Universal Form Item
        function createUniversalFormItem(form) {
            const item = document.createElement('div');
            item.className = 'form-item';
            
            item.innerHTML = `
                <div class="form-item__checkbox-container">
                    <input type="checkbox" class="form-item__checkbox" id="form-${Date.now()}-${Math.random()}">
                </div>
                <div class="form-item__content">
                    <div class="form-item__header">
                        <div class="form-item__name">${form.form_name}</div>
                        <div class="form-item__number">${form.form_number}</div>
                    </div>
                    <div class="form-item__details">
                        <div class="form-item__purpose">${form.purpose}</div>
                        <div class="form-item__timing">Required: ${form.when_required}</div>
                        <div class="form-item__compliance">${form.compliance}</div>
                        <div class="form-item__notes">${form.notes}</div>
                    </div>
                </div>
            `;
            
            return item;
        }

        // Form Handlers
        function setupFormHandlers() {
            const transactionForm = document.getElementById('transaction-form');
            if (transactionForm) {
                transactionForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleFormSubmission();
                });
                
                transactionForm.addEventListener('reset', function() {
                    const resultsSection = document.getElementById('results-section');
                    if (resultsSection) {
                        resultsSection.style.display = 'none';
                    }
                    resetTransactionState();
                });
            }
        }

        // Handle Form Submission
        function handleFormSubmission() {
            const formData = new FormData(document.getElementById('transaction-form'));
            
            // Update transaction state
            currentTransaction.propertyType = formData.get('property_type');
            currentTransaction.clientType = formData.get('client_type');
            currentTransaction.representationStatus = formData.get('representation_status');
            currentTransaction.fundHandling = formData.get('fund_handling');
            
            // Generate and display results
            generateTransactionResults();
            
            // Show results section with mobile-optimized scroll
            const resultsSection = document.getElementById('results-section');
            if (resultsSection) {
                resultsSection.style.display = 'block';
                
                // Mobile-optimized scroll behavior
                if (window.innerWidth < 768) {
                    setTimeout(() => {
                        resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100);
                } else {
                    resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        }

        // Generate Transaction Results
        function generateTransactionResults() {
            generatePropertySpecificForms();
            generateClauseRecommendations();
            generateComplianceChecklist();
        }

        // Generate Property Specific Forms
        function generatePropertySpecificForms() {
            const container = document.getElementById('property-forms-list');
            if (!container || !currentTransaction.propertyType) return;
            
            container.innerHTML = '';
            
            const forms = transactionSpecificForms[currentTransaction.propertyType];
            if (!forms) return;
            
            // Primary form
            const primarySection = document.createElement('div');
            primarySection.className = 'forms-category';
            primarySection.innerHTML = `
                <h3 class="forms-category__title">Primary Agreement Form</h3>
                <div class="forms-category__list">
                    <div class="form-list-item">${forms.primary}</div>
                </div>
            `;
            container.appendChild(primarySection);
            
            // Additional forms
            if (forms.additional && forms.additional.length > 0) {
                const additionalSection = document.createElement('div');
                additionalSection.className = 'forms-category';
                additionalSection.innerHTML = `
                    <h3 class="forms-category__title">Additional Required Forms</h3>
                    <div class="forms-category__list">
                        ${forms.additional.map(form => `<div class="form-list-item">${form}</div>`).join('')}
                    </div>
                `;
                container.appendChild(additionalSection);
            }
        }

        // Generate Clause Recommendations
        function generateClauseRecommendations() {
            const mandatoryContainer = document.getElementById('mandatory-clauses');
            const recommendedContainer = document.getElementById('recommended-clauses');
            
            if (!mandatoryContainer || !recommendedContainer) return;
            
            // Clear existing content
            mandatoryContainer.innerHTML = '';
            recommendedContainer.innerHTML = '';
            
            // Add clauses
            const mandatoryClauses = ['INSUR-1'];
            const recommendedClauses = ['INSP-1', 'MORT-2'];
            
            mandatoryClauses.forEach(clauseId => {
                if (clauseDatabase[clauseId]) {
                    mandatoryContainer.appendChild(createClauseItem({id: clauseId, ...clauseDatabase[clauseId]}));
                }
            });
            
            recommendedClauses.forEach(clauseId => {
                if (clauseDatabase[clauseId]) {
                    recommendedContainer.appendChild(createClauseItem({id: clauseId, ...clauseDatabase[clauseId]}));
                }
            });
        }

        // Create Clause Item
        function createClauseItem(clause) {
            const item = document.createElement('div');
            item.className = 'clause-item';
            
            item.innerHTML = `
                <div class="clause-item__header">
                    <div class="clause-item__title">
                        <div class="clause-item__name">${clause.name}</div>
                        <span class="clause-item__reference">${clause.id}</span>
                    </div>
                    <button type="button" class="btn btn--success btn--small clause-item__copy-btn" onclick="copyClauseText('${clause.id}')">
                        Copy Text
                    </button>
                </div>
                <textarea class="clause-item__text" readonly id="clause-text-${clause.id}">${clause.text}</textarea>
                <div class="clause-item__details">
                    <div class="clause-item__purpose">
                        <div class="clause-item__label">Purpose</div>
                        <div class="clause-item__description">${clause.purpose}</div>
                    </div>
                    <div class="clause-item__usage">
                        <div class="clause-item__label">When to Use</div>
                        <div class="clause-item__description">${clause.when_to_use}</div>
                    </div>
                </div>
            `;
            
            return item;
        }

        // Generate Compliance Checklist
        function generateComplianceChecklist() {
            const container = document.getElementById('compliance-checklist');
            if (!container) return;
            
            container.innerHTML = '';
            
            const checklistItems = [
                'RECO Information Guide provided and explained',
                'Privacy policy disclosed (PIPEDA compliance)',
                'Client identity verified (FINTRAC requirements)',
                'Representation agreement signed',
                'All mandatory disclosures completed',
                'Property-specific forms identified and prepared',
                'Required clauses included in agreement',
                'All conditions properly dated and timed',
                'Compliance with regulatory requirements verified'
            ];
            
            checklistItems.forEach((item, index) => {
                const checklistItem = document.createElement('div');
                checklistItem.className = 'compliance-item';
                checklistItem.innerHTML = `
                    <input type="checkbox" class="compliance-item__checkbox" id="compliance-${index}">
                    <label for="compliance-${index}" class="compliance-item__text">${item}</label>
                `;
                container.appendChild(checklistItem);
            });
        }

        // Export Handlers
        function setupExportHandlers() {
            const copyAllBtn = document.getElementById('copy-all-clauses');
            const generateSummaryBtn = document.getElementById('generate-summary');
            const printChecklistBtn = document.getElementById('print-checklist');
            const exportFormsBtn = document.getElementById('export-forms');
            const startNewBtn = document.getElementById('start-new-transaction');
            
            if (copyAllBtn) copyAllBtn.addEventListener('click', copyAllClauses);
            if (generateSummaryBtn) generateSummaryBtn.addEventListener('click', generateCompleteTransactionSummary);
            if (printChecklistBtn) printChecklistBtn.addEventListener('click', printComplianceChecklist);
            if (exportFormsBtn) exportFormsBtn.addEventListener('click', exportFormList);
            if (startNewBtn) startNewBtn.addEventListener('click', startNewTransaction);
        }

        // Copy Clause Text
        function copyClauseText(clauseId) {
            const textarea = document.getElementById(`clause-text-${clauseId}`);
            if (textarea) {
                textarea.select();
                textarea.setSelectionRange(0, 99999);
                
                try {
                    document.execCommand('copy');
                    // Haptic feedback on mobile
                    if ('vibrate' in navigator) {
                        navigator.vibrate(50);
                    }
                    showCopyToast(`${clauseId} clause copied!`);
                } catch (err) {
                    console.error('Copy failed:', err);
                    showCopyToast('Copy failed. Please try again.');
                }
            }
        }

        // Copy All Clauses
        function copyAllClauses() {
            const allClauses = [];
            document.querySelectorAll('.clause-item__text').forEach((textarea, index) => {
                const clauseName = textarea.closest('.clause-item').querySelector('.clause-item__name').textContent;
                const clauseReference = textarea.closest('.clause-item').querySelector('.clause-item__reference').textContent;
                allClauses.push(`${index + 1}. ${clauseName} (${clauseReference})\n\n${textarea.value}`);
            });
            
            const allText = `ONTARIO REAL ESTATE CLAUSES - TRANSACTION PACKAGE\n${'='.repeat(60)}\n\n${allClauses.join('\n\n' + '-'.repeat(60) + '\n\n')}`;
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(allText).then(() => {
                    if ('vibrate' in navigator) {
                        navigator.vibrate([50, 50, 50]);
                    }
                    showCopyToast('All clauses copied to clipboard!');
                }).catch(() => {
                    fallbackCopyToClipboard(allText);
                });
            } else {
                fallbackCopyToClipboard(allText);
            }
        }

        // Generate Complete Transaction Summary
        function generateCompleteTransactionSummary() {
            const currentDate = new Date().toLocaleDateString('en-CA');
            
            const summary = `
ONTARIO REAL ESTATE TRANSACTION SUMMARY
${'='.repeat(60)}

Generated: ${currentDate}
Property Type: ${currentTransaction.propertyType || 'Not specified'}
Client Type: ${currentTransaction.clientType || 'Not specified'}
Representation: ${currentTransaction.representationStatus || 'Not specified'}
Fund Handling: ${currentTransaction.fundHandling || 'Not specified'}

UNIVERSAL MANDATORY FORMS:
${Object.values(universalMandatoryForms).map((form, index) => `${index + 1}. ${form.form_name}`).join('\n')}

COMPLIANCE REQUIREMENTS:
âœ“ RECO/TRESA Requirements
âœ“ FINTRAC Compliance
âœ“ PIPEDA Compliance
âœ“ OREA Standards

Generated by Ontario Real Estate Transaction Tool
Personal Use Only
            `;
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(summary).then(() => {
                    if ('vibrate' in navigator) {
                        navigator.vibrate([100, 50, 100]);
                    }
                    showCopyToast('Complete Transaction Summary copied!');
                }).catch(() => {
                    fallbackCopyToClipboard(summary);
                });
            } else {
                fallbackCopyToClipboard(summary);
            }
        }

        // Print Compliance Checklist
        function printComplianceChecklist() {
            window.print();
        }

        // Export Form List
        function exportFormList() {
            const formsList = Object.values(universalMandatoryForms).map((form, index) => 
                `${index + 1}. ${form.form_name} - ${form.form_number}`
            );
            
            const formsText = `ONTARIO REAL ESTATE FORMS LIST\n${'='.repeat(40)}\n\n${formsList.join('\n')}`;
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(formsText).then(() => {
                    if ('vibrate' in navigator) {
                        navigator.vibrate(50);
                    }
                    showCopyToast('Forms list copied!');
                }).catch(() => {
                    fallbackCopyToClipboard(formsText);
                });
            } else {
                fallbackCopyToClipboard(formsText);
            }
        }

        // Start New Transaction
        function startNewTransaction() {
            const transactionForm = document.getElementById('transaction-form');
            if (transactionForm) {
                transactionForm.reset();
            }
            
            const resultsSection = document.getElementById('results-section');
            if (resultsSection) {
                resultsSection.style.display = 'none';
            }
            
            resetTransactionState();
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }
            showCopyToast('New transaction started!');
        }

        // Reset Transaction State
        function resetTransactionState() {
            currentTransaction = {
                propertyType: null,
                clientType: null,
                representationStatus: null,
                fundHandling: null
            };
        }

        // Fallback Copy Function
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showCopyToast('Text copied to clipboard!');
            } catch (err) {
                console.error('Failed to copy text: ', err);
                showCopyToast('Copy failed. Please copy manually.');
            }
            
            document.body.removeChild(textArea);
        }

        // Show Copy Toast - Mobile Optimized
        function showCopyToast(message = 'Copied to clipboard!') {
            const toast = document.getElementById('copy-toast');
            if (toast) {
                const toastText = toast.querySelector('.copy-toast__text');
                if (toastText) {
                    toastText.textContent = message;
                }
                
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
        }

        // Make functions globally available
        window.copyClauseText = copyClauseText;

        // Mobile-specific optimizations
        if (window.innerWidth < 768) {
            // Add touch event handling for better responsiveness
            document.addEventListener('touchstart', function() {}, {passive: true});
        }
    </script>
</body>
</html>
